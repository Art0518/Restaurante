<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Reservas - Admin | Un Rincón en San Juan</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="img/logo-rincon.png">
    <link rel="shortcut icon" type="image/png" href="img/logo-rincon.png">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    
    <!-- Fix para codificación de caracteres -->
    <script src="fix-charset.js"></script>
</head>
<body>
    <!-- Loading Component -->
<div id="loading-container"></div>
 <script>
        fetch("components/loading.html")
            .then(r => r.text())
       .then(html => {
    document.getElementById("loading-container").innerHTML = html;
       setTimeout(() => {
 const loader = document.querySelector(".loading-container");
     if (loader) {
    loader.style.opacity = "0";
           loader.style.transition = "opacity .5s ease";
   setTimeout(() => loader.style.display = "none", 500);
     }
     }, 1000);
});
    </script>

    <!-- NAVBAR -->
    <div id="navbar-container"></div>
<script>
        fetch("components/navbar.html")
   .then(res => res.text())
        .then(html => {
  document.getElementById("navbar-container").innerHTML = html;
     const script = document.createElement("script");
      script.src = "js/navbar.js";
        document.body.appendChild(script);
   });
    </script>

 <!-- AUTH MODAL -->
 <div id="auth-modal-container"></div>
    <script>
    fetch("components/auth-modal.html")
        .then(res => res.text())
   .then(html => {
 document.getElementById("auth-modal-container").innerHTML = html;
 })
        .catch(err => console.error("Error loading auth modal:", err));
    </script>

  <!-- NOTIFICATION MODAL -->
    <div id="notification-modal-container"></div>
    <script>
  fetch("components/notification-modal.html")
      .then(res => res.text())
   .then(html => {
  document.getElementById("notification-modal-container").innerHTML = html;
    })
      .catch(error => {
      console.error("Error cargando el modal de notificaciones:", error);
      });
    </script>

    <!-- CONFIRMATION MODAL -->
 <div id="confirmation-modal-container"></div>
    <script>
    fetch("components/confirmation-modal.html")
 .then(res => res.text())
       .then(html => {
 document.getElementById("confirmation-modal-container").innerHTML = html;
  })
     .catch(error => {
     console.error("Error cargando el modal de confirmación:", error);
   });
    </script>

    <!-- CONTENIDO PRINCIPAL -->
    <div class="container-fluid mt-4">
     <div class="row">
  <div class="col-12">
      
<!-- ENCABEZADO -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
         <h2 class="text-primary">
                  <i class="bi bi-clipboard-check"></i> 
      Gestión de Reservas - Administrador
     </h2>
   <p class="text-muted mb-0">Visualiza todas las reservas y gestiona la facturación</p>
          </div>
    <div>
         <button class="btn btn-outline-primary" onclick="cargarTodasReservas()">
      <i class="bi bi-arrow-clockwise"></i> Actualizar
        </button>
         </div>
</div>

    <!-- FILTROS -->
          <div class="card mb-4">
         <div class="card-header bg-light">
                 <h5 class="mb-0">
       <i class="bi bi-funnel"></i> Filtros de Búsqueda
              </h5>
          </div>
       <div class="card-body">
           <div class="row g-3">
         <div class="col-md-6">
       <label class="form-label">Estado:</label>
            <select class="form-select" id="filtro-estado">
      <option value="">Todos los estados</option>
          <option value="HOLD">En espera (HOLD)</option>
             <option value="CONFIRMADA">Confirmadas</option>
       </select>
         </div>
          <div class="col-md-6">
        <label class="form-label">Acciones:</label>
              <div class="d-grid">
       <button class="btn btn-primary" onclick="aplicarFiltros()">
       <i class="bi bi-search"></i> Filtrar
      </button>
    </div>
         </div>
        </div>
        </div>
      </div>

       <!-- ESTADISTICAS RAPIDAS -->
   <div class="row mb-4">
<div class="col-md-3">
  <div class="card bg-primary text-white">
      <div class="card-body">
    <div class="d-flex justify-content-between">
    <div>
 <h6 class="card-title">Total Reservas</h6>
 <h3 id="stat-total">0</h3>
 </div>
     <div class="align-self-center">
       <i class="bi bi-calendar-event" style="font-size: 2rem;"></i>
       </div>
 </div>
           </div>
  </div>
     </div>
  <div class="col-md-3">
  <div class="card bg-warning text-white">
   <div class="card-body">
        <div class="d-flex justify-content-between">
 <div>
     <h6 class="card-title">En Espera</h6>
     <h3 id="stat-hold">0</h3>
   </div>
           <div class="align-self-center">
   <i class="bi bi-clock-history" style="font-size: 2rem;"></i>
     </div>
   </div>
    </div>
    </div>
         </div>
    <div class="col-md-3">
  <div class="card bg-success text-white">
     <div class="card-body">
  <div class="d-flex justify-content-between">
     <div>
     <h6 class="card-title">Confirmadas</h6>
    <h3 id="stat-confirmadas">0</h3>
  </div>
<div class="align-self-center">
      <i class="bi bi-check-circle" style="font-size: 2rem;"></i>
     </div>
  </div>
    </div>
   </div>
         </div>
   <div class="col-md-3">
    <div class="card bg-info text-white">
             <div class="card-body">
   <div class="d-flex justify-content-between">
      <div>
      <h6 class="card-title">Total Ingresos</h6>
     <h3 id="stat-ingresos">$0.00</h3>
  </div>
      <div class="align-self-center">
       <i class="bi bi-currency-dollar" style="font-size: 2rem;"></i>
          </div>
    </div>
             </div>
  </div>
</div>
           </div>

        <!-- TABLA DE RESERVAS -->
            <div class="card">
        <div class="card-header bg-primary text-white">
             <h5 class="mb-0">
        <i class="bi bi-table"></i> Listado de Reservas
  </h5>
           </div>
             <div class="card-body p-0">
    
           <!-- MENSAJE DE CARGA -->
            <div id="loading-reservas" class="text-center py-5" style="display: none;">
          <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Cargando...</span>
           </div>
      <p class="mt-2 text-muted">Cargando reservas...</p>
                </div>

        <!-- TABLA RESPONSIVE -->
     <div class="table-responsive">
                <table class="table table-hover mb-0" id="tabla-reservas">
        <thead class="table-dark">
          <tr>
                <th>ID</th>
     <th>Cliente</th>
      <th>Mesa</th>
          <th>Fecha</th>
        <th>Hora</th>
         <th>Personas</th>
      <th>Total</th>
      <th>Estado</th>
           <th>Método Pago</th>
 <th>Acciones</th>
     </tr>
      </thead>
             <tbody id="reservas-tbody">
    <!-- Las reservas se cargan aqui dinamicamente -->
          </tbody>
             </table>
            </div>

   <!-- MENSAJE SIN DATOS -->
               <div id="sin-reservas" class="text-center py-5" style="display: none;">
         <i class="bi bi-inbox text-muted" style="font-size: 3rem;"></i>
   <h5 class="mt-3 text-muted">No hay reservas</h5>
              <p class="text-muted">No se encontraron reservas con los filtros aplicados.</p>
          </div>
    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <div id="footer-container" class="mt-5"></div>
    <script>
        fetch("components/footer.html")
 .then(res => res.text())
  .then(html => {
 document.getElementById("footer-container").innerHTML = html;
 })
       .catch(err => console.error("Error loading footer:", err));
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/global-init.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/admin-gestion-reservas.js"></script>
</body>
</html>